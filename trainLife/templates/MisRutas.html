<!DOCTYPE html>
<html lang="es">
{% load static %}

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Mis Rutas Guardadas - TrainLife</title>
    
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&amp;display=swap" rel="stylesheet" />
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'styles/sidebar.css' %}">
    <link rel="stylesheet" href="{% static 'styles/misRutas.css' %}">
    <link rel="stylesheet" href="{% static 'styles/confirmModal.css' %}">
    <link rel="stylesheet" href="{% static 'styles/color-modes.css' %}">

    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body data-color-mode="{{ color_mode }}">
    <a href="#contenido-principal" class="skip-link">Saltar al contenido principal</a>
     <div class="dashboard-container">
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" aria-label="Toggle menu">
            <i data-lucide="menu"></i>
        </button>

        <!-- Sidebar -->
        {% with seccion_actual='mis_rutas' %}
            {% include 'includes/sidebar.html' %}
        {% endwith %}

        <!-- Mensajes de Django -->
        {% if messages %}
            <div class="django-messages" style="display: none;">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <main id="contenido-principal" class="main-content" role="main" aria-label="Contenido principal">
            <div class="content-wrapper">
                <nav class="breadcrumb" aria-label="Breadcrumb">
                    <a href="{% url 'inicio_usuario' usuario.id %}" class="breadcrumb-item"
                        aria-label="Volver a inicio">Home</a>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-item breadcrumb-current">Mis Rutas</span>
                </nav>

                <h1 class="page-title">Mis Rutas Guardadas</h1>

                <div class="routes-container" role="list" aria-label="Lista de rutas guardadas">
                    {% if rutas %}
                    {% for ruta in rutas %}
                    <div class="route-card" role="listitem" aria-labelledby="route-{{ ruta.id }}-title">
                        <div class="route-header">
                            <div class="route-info">
                                <h2 class="route-title" id="route-{{ ruta.id }}-title">{{ ruta.nombre }}</h2>
                                {% if ruta.descripcion %}
                                <p class="route-subtitle">{{ ruta.descripcion }}</p>
                                {% endif %}
                                <div class="route-actions">
                                    <button class="btn btn-primary expand-route" data-route-id="{{ ruta.id }}"
                                        aria-expanded="false" aria-controls="route-{{ ruta.id }}-details"
                                        aria-label="Ver detalles de la ruta {{ ruta.nombre }}">
                                        <span>Ver Detalles</span>
                                    </button>
                                    <button class="btn btn-delete" 
                                        data-delete-route-id="{{ ruta.id }}"
                                        data-delete-route-name="{{ ruta.nombre|escapejs }}"
                                        data-delete-url="{% url 'eliminar_ruta_favorito' usuario.id ruta.id %}"
                                        aria-label="Eliminar ruta {{ ruta.nombre }} de favoritos">
                                        <i data-lucide="trash-2" aria-hidden="true"></i>
                                        <span>Eliminar de favoritos</span>
                                    </button>
                                </div>
                            </div>
                            <div class="route-map route-map-main" role="img"
                                aria-label="Mapa de la ruta {{ ruta.nombre }}"></div>
                        </div>

                        <div class="route-details" id="route-{{ ruta.id }}-details" style="display: none;" role="region"
                            aria-label="Detalles de la ruta {{ ruta.nombre }}">
                            <div class="transfers-badge" role="note" aria-label="Número de trayectos: {{ ruta.trayectos.count }}">
                                <span class="transfers-label">Trayectos:</span>
                                <span class="transfers-count">{{ ruta.trayectos.count }}</span>
                            </div>


                            {% for trayecto in ruta.trayectos.all %}
                            <div class="line-section" role="region" aria-labelledby="line-{{ trayecto.id }}-title">
                                <h3 class="line-title" id="line-{{ trayecto.id }}-title">{{ trayecto.nombreLinea }}</h3>
                                <div class="line-content">
                                    <div class="line-info-grid">
                                        <div class="info-item">
                                            <span class="info-label">Estación de Salida</span>
                                            <span class="info-value">{{ trayecto.estacionSalida }}</span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">Andén de Salida</span>
                                            <span class="info-value">{{ trayecto.andenSalida }}</span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">Estación de Llegada</span>
                                            <span class="info-value">{{ trayecto.estacionLlegada }}</span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">Andén de Llegada</span>
                                            <span class="info-value">{{ trayecto.andenLlegada }}</span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">Hora de Salida</span>
                                            <span class="info-value">{{ trayecto.horaSalida|time:"H:i" }}</span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">Hora de Llegada</span>
                                            <span class="info-value">{{ trayecto.horaLlegada|time:"H:i" }}</span>
                                        </div>
                                    </div>
                                    {% if trayecto.imagenMapa %}
                                    <div class="line-image-container">
                                        <span class="image-label">Imagen del Trayecto de la Línea</span>
                                        <img src="{{ trayecto.imagenMapa.url }}"
                                            alt="Mapa del trayecto de {{ trayecto.nombreLinea }}"
                                            class="line-route-image">
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="empty-state" style="text-align: center; padding: 3rem;">
                        <i data-lucide="map-pin"
                            style="width: 64px; height: 64px; margin: 0 auto 1rem; color: #9ca3af;"></i>
                        <p style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">No tienes rutas
                            guardadas</p>
                        <p style="color: #6b7280; margin-bottom: 1.5rem;">Explora y guarda tus rutas favoritas desde la
                            sección de Buscar Rutas</p>
                        <button class="btn btn-primary"
                            onclick="window.location.href='{% url 'buscar_rutas' usuario.id %}'">
                            Buscar Rutas
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>
        </main>
    </div>

    <!-- Custom JavaScript -->
    <script src="{% static 'js/confirmModal.js' %}"></script>
    <script src="{% static 'js/sidebar.js' %}"></script>
    <script defer src="{% static 'js/misRutas.js' %}"></script>

</body>

</html>